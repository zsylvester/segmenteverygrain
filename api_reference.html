

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>API Reference &#8212; segmenteverygrain 0.2.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api_reference';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">segmenteverygrain 0.2.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="getting_started.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">API Reference</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/api_reference.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>API Reference</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this heading">#</a></h1>
<div class="toctree-wrapper compound">
</div>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.calculate_iou">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">calculate_iou</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">poly1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.calculate_iou" title="Permalink to this definition">#</a></dt>
<dd><p>Calculate the Intersection over Union (IoU) between two polygons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>poly1</strong> (<em>Polygon</em>) – The first polygon.</p></li>
<li><p><strong>poly2</strong> (<em>Polygon</em>) – The second polygon.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>iou</strong> – The IoU value between the two polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.classify_points">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">classify_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.classify_points" title="Permalink to this definition">#</a></dt>
<dd><p>Classifies points based on their position relative to a line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature1</strong> (<em>list</em>) – List of x-coordinates of the points.</p></li>
<li><p><strong>feature2</strong> (<em>list</em>) – List of y-coordinates of the points.</p></li>
<li><p><strong>x1</strong> (<em>float</em>) – x-coordinate of the first point on the line.</p></li>
<li><p><strong>y1</strong> (<em>float</em>) – y-coordinate of the first point on the line.</p></li>
<li><p><strong>x2</strong> (<em>float</em>) – x-coordinate of the second point on the line.</p></li>
<li><p><strong>y2</strong> (<em>float</em>) – y-coordinate of the second point on the line.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of classifications for each point. Each classification is either 0 (on or one side of the line) or 1 (the other side of the line).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.click_for_scale">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">click_for_scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.click_for_scale" title="Permalink to this definition">#</a></dt>
<dd><p>Handles mouse click events to measure the distance between two points on a plot.
Prints the distance between the two points in number of pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse click event object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object representing the plot.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.collect_polygon_from_mask">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">collect_polygon_from_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_n_large_grains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_bg_fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.collect_polygon_from_mask" title="Permalink to this definition">#</a></dt>
<dd><p>Collect polygon from a mask and append it to a list of grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> (<em>ndarray</em>) – Array of labels for each pixel in the image.</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – Boolean mask indicating the region of interest.</p></li>
<li><p><strong>image_pred</strong> (<em>ndarray</em>) – Predicted image from the Unet model.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – List to append the resulting polygons to.</p></li>
<li><p><strong>sx</strong> (<em>ndarray</em>) – X-coordinates of the polygon vertices.</p></li>
<li><p><strong>sy</strong> (<em>ndarray</em>) – Y-coordinates of the polygon vertices.</p></li>
<li><p><strong>min_area</strong> (<em>int</em><em>, </em><em>optional</em>) – Minimum area for a label to be considered significant (default is 100).</p></li>
<li><p><strong>max_n_large_grains</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of large grains allowed in the mask (default is 10).</p></li>
<li><p><strong>max_bg_fraction</strong> (<em>float</em><em>, </em><em>optional</em>) – Maximum fraction of the mask that can be background (default is 0.7).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated list of polygons representing grains.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.compute_curvature">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">compute_curvature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.compute_curvature" title="Permalink to this definition">#</a></dt>
<dd><p>Compute first derivatives and curvature of a curve.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>1D array</em>) – x-coordinates of the curve</p></li>
<li><p><strong>y</strong> (<em>1D array</em>) – y-coordinates of the curve</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>curvature</strong> – curvature of the curve (in 1/units of x and y)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>1D array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.convert_to_large_image_coords">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">convert_to_large_image_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_origin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.convert_to_large_image_coords" title="Permalink to this definition">#</a></dt>
<dd><p>Convert the coordinates from the patch to the large image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sx</strong> (<em>int</em>) – The x-coordinate in the patch.</p></li>
<li><p><strong>sy</strong> (<em>int</em>) – The y-coordinate in the patch.</p></li>
<li><p><strong>patch_origin</strong> (<em>tuple</em>) – The (x, y) coordinates of the top-left corner of the patch in the large image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The (x, y) coordinates in the large image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_and_train_model">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_and_train_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_and_train_model" title="Permalink to this definition">#</a></dt>
<dd><p>Create and train a U-Net model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_file</strong> (<em>str</em>) – Path to the file containing the model weights.</p></li>
<li><p><strong>train_dataset</strong> (<em>tf.data.Dataset</em>) – Training dataset.</p></li>
<li><p><strong>val_dataset</strong> (<em>tf.data.Dataset</em>) – Validation dataset.</p></li>
<li><p><strong>test_dataset</strong> (<em>tf.data.Dataset</em>) – Test dataset.</p></li>
<li><p><strong>epochs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of epochs to train the model (default is 100).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>model</strong> – Trained U-Net model.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tf.keras.Model</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function will plot the training and validation loss and accuracy over epochs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_labeled_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_labeled_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_labeled_image" title="Permalink to this definition">#</a></dt>
<dd><p>Create a labeled image based on the provided grains and input image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of shapely Polygon objects representing the grains.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – Input image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>rasterized</strong> (<em>numpy.ndarray</em>) – Labeled image where each grain is assigned a unique label.</p></li>
<li><p><strong>mask_all</strong> (<em>numpy.ndarray</em>) – Binary mask indicating the presence of grains and their boundaries.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_train_val_test_data">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_train_val_test_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_train_val_test_data" title="Permalink to this definition">#</a></dt>
<dd><p>Splits image and mask data into training, validation, and test datasets, with optional augmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_dir</strong> (<em>str</em>) – Directory containing the image files.</p></li>
<li><p><strong>mask_dir</strong> (<em>str</em>) – Directory containing the mask files.</p></li>
<li><p><strong>augmentation</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, applies data augmentation to the training dataset (default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>train_dataset</strong> (<em>tf.data.Dataset</em>) – TensorFlow dataset for training.</p></li>
<li><p><strong>val_dataset</strong> (<em>tf.data.Dataset</em>) – TensorFlow dataset for validation.</p></li>
<li><p><strong>test_dataset</strong> (<em>tf.data.Dataset</em>) – TensorFlow dataset for testing.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.extract_patch">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">extract_patch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.extract_patch" title="Permalink to this definition">#</a></dt>
<dd><p>Extract a patch from the image centered on the given coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>np.ndarray</em>) – The large image from which to extract the patch.</p></li>
<li><p><strong>center</strong> (<em>tuple</em>) – The (x, y) coordinates of the center of the patch.</p></li>
<li><p><strong>patch_size</strong> (<em>int</em>) – The size of the patch (assumed to be square).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The extracted patch.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.find_connected_components">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">find_connected_components</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.find_connected_components" title="Permalink to this definition">#</a></dt>
<dd><p>Finds connected components in a graph of overlapping polygons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of polygons representing all grains.</p></li>
<li><p><strong>min_area</strong> (<em>float</em>) – Minimum area threshold for valid grains.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>new_grains</strong> (<em>list</em>) – List of polygons that do not overlap and have an area greater than min_area.</p></li>
<li><p><strong>comps</strong> (<em>list</em>) – List of sets, where each set represents a connected component of overlapping polygons.</p></li>
<li><p><strong>g</strong> (<em>networkx.Graph</em>) – The graph of overlapping polygons.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.find_grain_size_classes">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">find_grain_size_classes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_size_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlimits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.find_grain_size_classes" title="Permalink to this definition">#</a></dt>
<dd><p>Find grain size classes that overlap with a given range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grain_size_classes</strong> (<em>dict</em>) – A dictionary where keys are grain size class names and values are tuples
of (lower_bound, upper_bound) representing the size range of each class.</p></li>
<li><p><strong>value1</strong> (<em>float</em>) – One end of the range to check for overlapping grain size classes.</p></li>
<li><p><strong>value2</strong> (<em>float</em>) – The other end of the range to check for overlapping grain size classes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>matching_classes</strong> (<em>list</em>) – A list of grain size class names that overlap with the given range.</p></li>
<li><p><strong>bounds</strong> (<em>list</em>) – A list of unique bounds (both lower and upper) from the matching classes.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.find_overlapping_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">find_overlapping_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_overlap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.find_overlapping_polygons" title="Permalink to this definition">#</a></dt>
<dd><p>Finds and returns a list of overlapping polygons from the given list of polygons using spatial indexing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>polygons</strong> (<em>list</em>) – A list of polygons.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>overlapping_polygons</strong> – A list of tuples representing the indices of overlapping polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.get_area_weighted_distribution">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">get_area_weighted_distribution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">areas</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.get_area_weighted_distribution" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.get_grains_from_patches">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">get_grains_from_patches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.get_grains_from_patches" title="Permalink to this definition">#</a></dt>
<dd><p>Extract grains from patches on a plot and create a labeled image based on the updated set of grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object containing the patches.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of Polygon objects representing the extracted grains.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – The labeled image where each grain is assigned a unique label.</p></li>
<li><p><strong>mask_all</strong> (<em>numpy.ndarray</em>) – The binary mask image where grains and their boundaries are marked.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The matplotlib Figure object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.label_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">label_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbs_max_dist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.label_grains" title="Permalink to this definition">#</a></dt>
<dd><p>Label grains in semantic segmentation result and generate prompts for SAM model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>2D</em><em> or </em><em>3d array</em>) – image that was segmented</p></li>
<li><p><strong>image_pred</strong> (<em>3D array</em>) – semantic segmentation result</p></li>
<li><p><strong>dbs_max_dist</strong> (<em>float</em>) – DBSCAN distance parameter; decreasing it results in more SAM prompts and longer processing times</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>labels_simple</em> – the labels as an image</p></li>
<li><p><em>all_coords</em> – pixel coordinates of the prompts</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.load_and_preprocess">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">load_and_preprocess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.load_and_preprocess" title="Permalink to this definition">#</a></dt>
<dd><p>Load and preprocess an image and its corresponding mask.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_path</strong> (<em>str</em>) – The file path of the image.</p></li>
<li><p><strong>mask_path</strong> (<em>str</em>) – The file path of the mask.</p></li>
<li><p><strong>augmentations</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to apply augmentations to the image. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – the preprocessed image.</p></li>
<li><p><strong>mask</strong> (<em>numpy.ndarray</em>) – the preprocessed mask.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.merge_overlapping_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">merge_overlapping_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.merge_overlapping_polygons" title="Permalink to this definition">#</a></dt>
<dd><p>Merge overlapping polygons in a connected component.</p>
<p>This function takes a list of all polygons, a list of polygons that do not overlap with other polygons,
a list of connected components, a minimum area threshold, and the Unet prediction.
It iterates over each connected component and merges the overlapping polygons within that component.
The most similar polygon is selected as the representative polygon for the merged region.
If the area of the representative polygon is greater than the minimum area threshold, it is added to the new polygons list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of all polygons.</p></li>
<li><p><strong>new_grains</strong> (<em>list</em>) – List of polygons that do not overlap each other.</p></li>
<li><p><strong>comps</strong> (<em>list</em>) – List of connected components.</p></li>
<li><p><strong>min_area</strong> (<em>float</em>) – Minimum area threshold.</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em>) – The Unet prediction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>all_grains</strong> – List of merged polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onclick">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onclick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onclick" title="Permalink to this definition">#</a></dt>
<dd><p>Run the SAM segmentation based on the prompt that comes from a mouse click event.
If left mouse button is clicked, the point is used as an object (label=1) and a mask is added.
If right mouse button is clicked, the point is used as background (label=0) and the
current mask is adjusted accordingly (if possible).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse click event object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object.</p></li>
<li><p><strong>coords</strong> (<em>list</em>) – A list to store the coordinates of the clicked points.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The image data.</p></li>
<li><p><strong>predictor</strong> (<em>SamPredictor</em>) – The predictor object for segmentation.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onclick2">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onclick2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onclick2" title="Permalink to this definition">#</a></dt>
<dd><p>Event handler function for selecting and highlighting grains in a plot,
based on mouse click events. The selected grains then are either deleted or merged,
using the ‘onpress2’ function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse click event object.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of all the grains (polygons).</p></li>
<li><p><strong>grain_inds</strong> (<em>list</em>) – A list to store the indices of the selected grains.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object representing the plot.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onclick_large_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onclick_large_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onclick_large_image" title="Permalink to this definition">#</a></dt>
<dd><p>Handles mouse click events on a large image for segmentation purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse event that triggered the function.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes object where the image is displayed.</p></li>
<li><p><strong>coords</strong> (<em>list of tuple</em>) – List of coordinates where the user has clicked.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The large image on which segmentation is performed.</p></li>
<li><p><strong>predictor</strong> (<em>object</em>) – The predictor object used for segmentation.</p></li>
<li><p><strong>patch_size</strong> (<em>int</em><em>, </em><em>optional</em>) – The size of the patch to extract around the clicked point (default is 1000).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Left mouse button (event.button == 1) is used to add an object.</p></li>
<li><p>Right mouse button (event.button == 3) is used to remove the last added object.</p></li>
<li><p>The function updates the display with the segmented region.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.one_point_prompt">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">one_point_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.one_point_prompt" title="Permalink to this definition">#</a></dt>
<dd><p>Perform SAM segmentation using a single point prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>float</em>) – the x-coordinate of the point</p></li>
<li><p><strong>y</strong> (<em>float</em>) – the y-coordinate of the point</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em><em>)</em>) – the input image</p></li>
<li><p><strong>predictor</strong> – the SAM predictor</p></li>
<li><p><strong>ax</strong> (<em>bool</em><em>, </em><em>default True</em>) – whether to plot the segmentation result on an axis</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>sx</em> – the x-coordinates of the contour points</p></li>
<li><p><em>sy</em> – the y-coordinates of the contour points</p></li>
<li><p><em>mask</em> – the segmented mask</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onpress">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onpress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onpress" title="Permalink to this definition">#</a></dt>
<dd><p>Handle key press events for deleting or merging polygons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.KeyEvent</em>) – The key press event object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The matplotlib Figure object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onpress2">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onpress2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onpress2" title="Permalink to this definition">#</a></dt>
<dd><p>Handle key press events when deleting or merging grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.KeyEvent</em>) – The key press event object.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of all grains (polygons).</p></li>
<li><p><strong>grain_inds</strong> (<em>list</em>) – A list of indices corresponding to the grains.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The figure object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.patchify_training_data">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">patchify_training_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.patchify_training_data" title="Permalink to this definition">#</a></dt>
<dd><p>Extracts patches from training images and labels, and saves them to the specified directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – The directory containing the input images and labels.</p></li>
<li><p><strong>patch_dir</strong> (<em>str</em>) – The directory where the patches will be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the paths to the directories where the image patches and label patches are saved.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The function expects the input directory to contain files with ‘image’ and ‘mask’ in their filenames.</p></li>
<li><p>The patches are extracted with a size of 256x256 pixels and a stride of 128 pixels.</p></li>
<li><p>The function creates subdirectories ‘images’ and ‘labels’ within the specified patch directory to save the patches.</p></li>
<li><p>If the input directory does not exist or contains no matching files, the function will print a warning and return.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.pick_most_similar_polygon">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">pick_most_similar_polygon</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.pick_most_similar_polygon" title="Permalink to this definition">#</a></dt>
<dd><p>Picks the ‘most similar’ polygon from a list of polygons based on the average IoU scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>polygons</strong> (<em>list</em>) – A list of polygons.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>most_similar_polygon</strong> – The most similar polygon.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Polygon</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_grain_axes_and_centroids">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_grain_axes_and_centroids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linewidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">markersize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_grain_axes_and_centroids" title="Permalink to this definition">#</a></dt>
<dd><p>Plot the axes and centroids of each grain on the given axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of all grains.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – Array of labeled regions.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axis object to plot on.</p></li>
<li><p><strong>linewidth</strong> (<em>int</em><em>, </em><em>optional</em>) – Width of the lines to plot (default is 1).</p></li>
<li><p><strong>markersize</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the markers to plot (default is 10).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_histogram_of_axis_lengths">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_histogram_of_axis_lengths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">major_axis_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minor_axis_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlimits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_histogram_of_axis_lengths" title="Permalink to this definition">#</a></dt>
<dd><p>Plots a histogram of the major and minor axis lengths in phi scale.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>major_axis_length</strong> (<em>array-like</em>) – The lengths of the major axes of the grains in millimeters.</p></li>
<li><p><strong>minor_axis_length</strong> (<em>array-like</em>) – The lengths of the minor axes of the grains in millimeters.</p></li>
<li><p><strong>area</strong> (<em>array-like</em><em>, </em><em>optional</em>) – The areas of the grains in square millimeters. If provided, the axis lengths will be weighted by the area.</p></li>
<li><p><strong>binsize</strong> (<em>float</em><em>, </em><em>optional</em>) – The size of the bins for the histogram. Default is 0.1.</p></li>
<li><p><strong>xlimits</strong> (<em>tuple</em><em>, </em><em>optional</em>) – The limits for the x-axis in millimeters. If not provided, the limits will be determined from the data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The figure object containing the plot.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes._subplots.AxesSubplot</em>) – The axes object containing the plot.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_image_w_colorful_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_image_w_colorful_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'viridis'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_image_w_colorful_grains" title="Permalink to this definition">#</a></dt>
<dd><p>Plot image with randomly colored grain masks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image to be plotted.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of shapely Polygon objects representing the grain masks.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes object on which to plot the image and grain masks.</p></li>
<li><p><strong>cmap</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the colormap to use for coloring the grain masks. Default is ‘viridis’.</p></li>
<li><p><strong>plot_image</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to plot the image. Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_images_and_labels">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_images_and_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_images_and_labels" title="Permalink to this definition">#</a></dt>
<dd><p>Plot the input image and its corresponding label side by side.
The third subplot shows the input image with the label overlayed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>numpy.ndarray</em>) – The input image to be plotted.</p></li>
<li><p><strong>label</strong> (<em>numpy.ndarray</em>) – The label image to be plotted.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.predict_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">predict_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">I</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.predict_image" title="Permalink to this definition">#</a></dt>
<dd><p>Segmantic segmentation of the entire image using a Unet model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>2D</em><em> or </em><em>3D array</em>) – The image that is being segmented. Can have one or more channels.</p></li>
<li><p><strong>model</strong> – Tensorflow model used for semantic segmentation.</p></li>
<li><p><strong>I</strong> (<em>int</em>) – Size of the square-shaped image tiles in pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>image_pred</strong> – Semantic segmentation result for the input image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.predict_image_tile">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">predict_image_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im_tile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.predict_image_tile" title="Permalink to this definition">#</a></dt>
<dd><p>Predicts one image tile using a Unet model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im_tile</strong> (<em>3D array</em>) – The image tile for which the prediction will be done.</p></li>
<li><p><strong>model</strong> – Tensorflow model used for semantic segmentation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>im_tile_pred</strong> – Predicted tile.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.predict_large_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">predict_large_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_large_objects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.predict_large_image" title="Permalink to this definition">#</a></dt>
<dd><p>Predicts the location of grains in a large image using a patch-based approach.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – The file path of the input image.</p></li>
<li><p><strong>model</strong> (<em>tensorflow.keras.Model</em>) – The Unet model used for the preliminary grain prediction.</p></li>
<li><p><strong>sam</strong> (<em>SamPredictor</em>) – The SAM model used for grain segmentation.</p></li>
<li><p><strong>min_area</strong> (<em>int</em>) – The minimum area threshold for valid grains.</p></li>
<li><p><strong>patch_size</strong> (<em>int</em><em>, </em><em>optional</em>) – The size of each patch. Defaults to 2000.</p></li>
<li><p><strong>overlap</strong> (<em>int</em><em>, </em><em>optional</em>) – The overlap between patches. Defaults to 300.</p></li>
<li><p><strong>remove_large_objects</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove large objects from the segmentation. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>All_Grains</strong> (<em>list</em>) – A list of grains represented as polygons.</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em>) – The Unet predictions for the entire image.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.rasterize_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">rasterize_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.rasterize_grains" title="Permalink to this definition">#</a></dt>
<dd><p>Rasterizes a list of polygons representing grains into an array of labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of polygons representing grains.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rasterized array of labels.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.read_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">read_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.read_polygons" title="Permalink to this definition">#</a></dt>
<dd><p>Reads polygons from a GeoJSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fname</strong> (<em>str</em>) – The file path to the GeoJSON file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of Shapely Polygon objects extracted from the GeoJSON file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.sam_segmentation">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">sam_segmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_edge_grains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_large_objects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.sam_segmentation" title="Permalink to this definition">#</a></dt>
<dd><p>Perform segmentation using the Segment Anything Model (SAM).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sam</strong> (<em>SamPredictor</em>) – The SAM model.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image.</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em>) – The output of the Unet segmentation.</p></li>
<li><p><strong>coords</strong> (<em>numpy.ndarray</em>) – The coordinates of the SAM prompts.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – The labeled image that comes from the ‘label_grains’ function.</p></li>
<li><p><strong>min_area</strong> (<em>int</em>) – The minimum area of the grains, in pixels.</p></li>
<li><p><strong>plot_image</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to plot the segmented image. Default is False.</p></li>
<li><p><strong>remove_edge_grains</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove grains that are touching the edge of the image. Default is False.</p></li>
<li><p><strong>remove_large_objects</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove large objects. Default is False. This is useful when the segmentation result is not very good.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of polygons representing the segmented grains.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – The labeled image.</p></li>
<li><p><strong>mask_all</strong> (<em>numpy.ndarray</em>) – The mask of all grains.</p></li>
<li><p><strong>grain_data</strong> (<em>pandas.DataFrame</em>) – DataFrame containing properties of each grain.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure or None</em>) – The figure object if plot_image is True, otherwise None.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes or None</em>) – The axes object if plot_image is True, otherwise None.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.save_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">save_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.save_polygons" title="Permalink to this definition">#</a></dt>
<dd><p>Save a list of polygons to a file in GeoJSON format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>polygons</strong> (<em>list</em>) – A list of Shapely polygon objects to be saved.</p></li>
<li><p><strong>fname</strong> (<em>str</em>) – The filename where the GeoJSON data will be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.two_point_prompt">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">two_point_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.two_point_prompt" title="Permalink to this definition">#</a></dt>
<dd><p>Perform a two-point-prompt-based segmentation using the SAM model.
Second point is used as background (label=0).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x1</strong> (<em>float</em>) – x-coordinate of the first point</p></li>
<li><p><strong>y1</strong> (<em>float</em>) – y-coordinate of the first point</p></li>
<li><p><strong>x2</strong> (<em>float</em>) – x-coordinate of the second point</p></li>
<li><p><strong>y2</strong> (<em>float</em>) – y-coordinate of the second point</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes to plot the segmentation result</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – the input image</p></li>
<li><p><strong>predictor</strong> – the SAM predictor</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>sx</strong> (<em>numpy.ndarray</em>) – The x-coordinates of the contour points</p></li>
<li><p><strong>sy</strong> (<em>numpy.ndarray</em>) – The y-coordinates of the contour points</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.Unet">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">Unet</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.Unet" title="Permalink to this definition">#</a></dt>
<dd><p>Creates a U-Net model for image segmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model</strong> – The U-Net model.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tensorflow.keras.Model</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.weighted_crossentropy">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">weighted_crossentropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.weighted_crossentropy" title="Permalink to this definition">#</a></dt>
<dd><p>Calculates the weighted cross-entropy loss between the true labels and predicted labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>tensor</em>) – True labels.</p></li>
<li><p><strong>y_pred</strong> (<em>tensor</em>) – Predicted labels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>loss</strong> – Weighted cross-entropy loss.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tensor</p>
</dd>
</dl>
</dd></dl>

</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="getting_started.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Getting started</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Zoltan Sylvester
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Zoltan Sylvester.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>