<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>API Reference &#8212; segmenteverygrain 0.2.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=37f418d5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="interactive-editing-interactions-module">
<h2>Interactive Editing (interactions module)<a class="headerlink" href="#interactive-editing-interactions-module" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">interactions</span></code> module provides an interactive interface for editing grain segmentations.</p>
<section id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">GrainPlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grains</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SamPredictor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_per_m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minspan</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_alpha</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_max_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">array([2160,</span> <span class="pre">4096])</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color_palette</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'tab20'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot" title="Link to this definition">¶</a></dt>
<dd><p>Interactive plot to create, delete, and merge grains.</p>
<p>Mouse Controls:
- Left-click on mask-free area: Create grain immediately (auto-create)
- Left-click on existing grain: Select/unselect grain
- Right-click on mask-free area: Add background prompt and create grain
- Alt + Left-click: Add foreground prompt (hold Alt for multiple prompts)
- Alt + Right-click: Add background prompt (hold Alt for multiple prompts)
- Shift+Left-click: Show grain measurement info (alternative to middle-click)
- Shift+Left-drag: Draw scale bar line (red line shows the scale reference)
- Middle-click: Show grain measurement info</p>
<p>Keyboard Controls:
- Alt (hold): Enable multiple prompt mode (click to place prompts, release Alt to create)
- M: Merge selected grains
- Shift (hold): Enable scale bar drawing mode
- Ctrl (hold): Hide all grain segmentations temporarily
- C: Create grain from existing prompts (alternative to auto-create)
- D/Delete: Delete selected grains
- Z: Undo last created grain
- Escape: Clear all selections and prompts</p>
<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.activate">
<span class="sig-name descname"><span class="pre">activate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.activate" title="Link to this definition">¶</a></dt>
<dd><p>Enable interactive features.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.clear_all">
<span class="sig-name descname"><span class="pre">clear_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.clear_all" title="Link to this definition">¶</a></dt>
<dd><p>Clear prompts, unselect all grains, and hide the info box.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.clear_box">
<span class="sig-name descname"><span class="pre">clear_box</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.clear_box" title="Link to this definition">¶</a></dt>
<dd><p>Alias for self.box_selector.clear().</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.clear_grains">
<span class="sig-name descname"><span class="pre">clear_grains</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.clear_grains" title="Link to this definition">¶</a></dt>
<dd><p>Unselect all selected grains.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.clear_info">
<span class="sig-name descname"><span class="pre">clear_info</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.clear_info" title="Link to this definition">¶</a></dt>
<dd><p>Clear the grain info box.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.clear_points">
<span class="sig-name descname"><span class="pre">clear_points</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.clear_points" title="Link to this definition">¶</a></dt>
<dd><p>Clear all prompt points.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.create_grain">
<span class="sig-name descname"><span class="pre">create_grain</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#segmenteverygrain.Grain" title="segmenteverygrain.interactions.Grain"><span class="pre">Grain</span></a></span></span><a class="headerlink" href="#segmenteverygrain.GrainPlot.create_grain" title="Link to this definition">¶</a></dt>
<dd><p>Attempt to detect a grain based on given prompts.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_grain</strong> – Grain detected using previously-input prompts.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#segmenteverygrain.Grain" title="segmenteverygrain.Grain">Grain</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.deactivate">
<span class="sig-name descname"><span class="pre">deactivate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.deactivate" title="Link to this definition">¶</a></dt>
<dd><p>Disable interactive features.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.delete_grains">
<span class="sig-name descname"><span class="pre">delete_grains</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.delete_grains" title="Link to this definition">¶</a></dt>
<dd><p>Delete all selected grains.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.draw_axes">
<span class="sig-name descname"><span class="pre">draw_axes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.draw_axes" title="Link to this definition">¶</a></dt>
<dd><p>Draw the major and minor axes on each grain patch.</p>
<p>This method collects all axis data first, then plots them all at once
on top of the grain masks to ensure proper z-ordering.</p>
<p>Note: Call this after deactivate() to draw axes on top of grain masks.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.draw_scale_line">
<span class="sig-name descname"><span class="pre">draw_scale_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.draw_scale_line" title="Link to this definition">¶</a></dt>
<dd><p>Draw a scale bar line and calculate the scale based on its length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start</strong> (<em>tuple</em>) – Starting point (x, y) of the scale line.</p></li>
<li><p><strong>end</strong> (<em>tuple</em>) – Ending point (x, y) of the scale line.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.get_grains">
<span class="sig-name descname"><span class="pre">get_grains</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#segmenteverygrain.GrainPlot.get_grains" title="Link to this definition">¶</a></dt>
<dd><p>Get the current list of grains.</p>
<p>This returns the live grain list that reflects all interactive edits
(created, deleted, merged grains). You can use this to save the current
state without needing to write to disk first.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>grains</strong> – Current list of Grain objects, including all edits.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.hide_grains">
<span class="sig-name descname"><span class="pre">hide_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hide</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.hide_grains" title="Link to this definition">¶</a></dt>
<dd><p>Hide or unhide all grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>hide</strong> (<em>bool</em>) – Whether to hide (True) or unhide (False) all grains.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hide</strong> – New hidden status.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.merge_grains">
<span class="sig-name descname"><span class="pre">merge_grains</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#segmenteverygrain.Grain" title="segmenteverygrain.interactions.Grain"><span class="pre">Grain</span></a></span></span><a class="headerlink" href="#segmenteverygrain.GrainPlot.merge_grains" title="Link to this definition">¶</a></dt>
<dd><p>Attempt to merge all selected grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_grain</strong> – Merged grain, if merge is successful. None otherwise.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#segmenteverygrain.Grain" title="segmenteverygrain.Grain">Grain</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.onclick">
<span class="sig-name descname"><span class="pre">onclick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">MouseEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.onclick" title="Link to this definition">¶</a></dt>
<dd><p>Handle clicking anywhere on plot.
Places foreground or background prompts for grain creation.
Shift + Left drag draws a scale bar line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>MouseEvent</em>) – Event details</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.onclickup">
<span class="sig-name descname"><span class="pre">onclickup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">MouseEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.onclickup" title="Link to this definition">¶</a></dt>
<dd><p>Handle click release events anywhere on plot.
Completes scale bar line drawing if in progress.
Displays info about any grain indicated with middle-click or Shift+left-click.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>MouseEvent</em>) – Event details</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.ondraw">
<span class="sig-name descname"><span class="pre">ondraw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DrawEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.ondraw" title="Link to this definition">¶</a></dt>
<dd><p>Update saved background image whenever a full redraw is triggered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>DrawEvent</em>) – Event details</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.onkey">
<span class="sig-name descname"><span class="pre">onkey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">KeyEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.onkey" title="Link to this definition">¶</a></dt>
<dd><p>Handle key presses as follows:
c: Create a grain from existing prompts (alternative to auto-create).
d: Delete a selected grain.
alt (hold): Allow placing multiple prompts before creating grain.
m: Merge selected grains.
z: Undo the most recently created grain.
control (hold): Temporarily hide all grains.
escape: Remove all selections, prompts, and info.
shift: Activate scale bar selector and grain selection box.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>KeyEvent</em>) – Event details</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.onkeyup">
<span class="sig-name descname"><span class="pre">onkeyup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">KeyEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.onkeyup" title="Link to this definition">¶</a></dt>
<dd><p>Handle key releases.
Unhides hidden grains, creates grain from multiple prompts, or deactivates selectors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>KeyEvent</em>) – Event details.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.onmotion">
<span class="sig-name descname"><span class="pre">onmotion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">MouseEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.onmotion" title="Link to this definition">¶</a></dt>
<dd><p>Handle mouse motion events.
Updates the scale line preview while dragging.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>MouseEvent</em>) – Event details</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.onpick">
<span class="sig-name descname"><span class="pre">onpick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PickEvent</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.onpick" title="Link to this definition">¶</a></dt>
<dd><p>Handle clicking on an existing grain.
Left-click: Select/unselect the grain.
Middle-click OR Shift+Left-click: Show measurement info for indicated grain.
Right-click: Ignored (passes through to onclick for background prompts).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<em>PickEvent</em>) – Event details</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.savefig">
<span class="sig-name descname"><span class="pre">savefig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.savefig" title="Link to this definition">¶</a></dt>
<dd><p>Save figure to disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fn</strong> (<em>str</em>) – Filename for output image. File type is determined by extension.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.set_point">
<span class="sig-name descname"><span class="pre">set_point</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">foreground</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Circle</span></span></span><a class="headerlink" href="#segmenteverygrain.GrainPlot.set_point" title="Link to this definition">¶</a></dt>
<dd><p>Set point prompt, either foreground or background.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xy</strong> (<em>(</em><em>x: int</em><em>, </em><em>y: int</em><em>)</em>) – Coordinates of newly-requested point.</p></li>
<li><p><strong>foreground</strong> (<em>bool</em>) – Whether point represents a foreground (True) or background prompt.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>new_point</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>mpatches.Circle</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.toggle_box">
<span class="sig-name descname"><span class="pre">toggle_box</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">active</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#segmenteverygrain.GrainPlot.toggle_box" title="Link to this definition">¶</a></dt>
<dd><p>Activate/deactivate selection box.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>active</strong> (<em>bool</em>) – Whether to activate (True) or deactivate (False) the selection box.
If not provided, will toggle current active status.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>active</strong> – Updated active status of the selection box.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.undo_grain">
<span class="sig-name descname"><span class="pre">undo_grain</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.undo_grain" title="Link to this definition">¶</a></dt>
<dd><p>Remove latest created grain.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.update" title="Link to this definition">¶</a></dt>
<dd><p>Blit background image and draw animated artists.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.GrainPlot.update_info">
<span class="sig-name descname"><span class="pre">update_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#segmenteverygrain.Grain" title="segmenteverygrain.interactions.Grain"><span class="pre">Grain</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.GrainPlot.update_info" title="Link to this definition">¶</a></dt>
<dd><p>Update info box for specified grain.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="segmenteverygrain.Grain">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">Grain</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.Grain" title="Link to this definition">¶</a></dt>
<dd><p>Stores data and plot representation for a single grain.</p>
<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.convert_units">
<span class="sig-name descname"><span class="pre">convert_units</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#segmenteverygrain.Grain.convert_units" title="Link to this definition">¶</a></dt>
<dd><p>Return grian measurements scaled by a given factor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scale</strong> (<em>float</em>) – Factor by which to scale grain properties.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>data</strong> – Rescaled grain measurements.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.draw_axes">
<span class="sig-name descname"><span class="pre">draw_axes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Axes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list[&lt;module</span> <span class="pre">'matplotlib.artist'</span> <span class="pre">from</span> <span class="pre">'/Users/zoltan/miniforge3/envs/segmenteverygrain/lib/python3.9/site-packages/matplotlib/artist.py'&gt;]</span></span></span><a class="headerlink" href="#segmenteverygrain.Grain.draw_axes" title="Link to this definition">¶</a></dt>
<dd><p>Draw centroid and major/minor axes on the provided matplotlib axes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>matplotlib.Axes</em>) – Axes instance on which to draw the grain properties.</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – Scaling factor, useful with downscaled GrainPlots.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>artists</strong> – Dict of Matplotlib artists, named by property that they represent.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{ name : artist }</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.draw_patch">
<span class="sig-name descname"><span class="pre">draw_patch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Axes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Polygon</span></span></span><a class="headerlink" href="#segmenteverygrain.Grain.draw_patch" title="Link to this definition">¶</a></dt>
<dd><p>Draw this grain on the provided matplotlib axes and save the result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>matplotlib.Axes</em>) – Axes instance on which to draw this grain.</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – Scaling factor, useful with downscaled GrainPlots.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Object representing this grain on the plot.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>patch</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.erase">
<span class="sig-name descname"><span class="pre">erase</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.Grain.erase" title="Link to this definition">¶</a></dt>
<dd><p>Remove plot representation.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.measure">
<span class="sig-name descname"><span class="pre">measure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raster</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#segmenteverygrain.Grain.measure" title="Link to this definition">¶</a></dt>
<dd><p>Calculate grain information from image and matplotlib patch.
Overwrites self.data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>raster</strong> (<em>bool</em>) – Whether to use the “old” method of measuring grain properties.
If True, will measure all properties from a raster representation.
If False, will prefer measurements directly from grain coords.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>self.data</strong> – Row for a DataFrame containing computed grain info.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.polygon">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">polygon</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Polygon</span></em><a class="headerlink" href="#segmenteverygrain.Grain.polygon" title="Link to this definition">¶</a></dt>
<dd><p>Return a shapely.Polygon representing the matplotlib patch.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Polygon representing the boundaries of this grain.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>shapely.Polygon</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.Grain.select">
<span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#segmenteverygrain.Grain.select" title="Link to this definition">¶</a></dt>
<dd><p>Toggle whether grain is selected/unselected in a plot.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>self.selected</strong> – True if this grain is now selected.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.load_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">load_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#segmenteverygrain.load_image" title="Link to this definition">¶</a></dt>
<dd><p>Load an image from disk as a numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fn</strong> (<em>str</em>) – Filename for image to load.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Memory representation of loaded image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.polygons_to_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">polygons_to_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#segmenteverygrain.polygons_to_grains" title="Link to this definition">¶</a></dt>
<dd><p>Construct grains from a list of polygons defining grain boundaries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>polygons</strong> (<em>list</em><em> of </em><em>shapely.Polygon</em>) – Polygons defining grain boundaries.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Grain objects created from provided polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.save_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">save_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grains</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.save_grains" title="Link to this definition">¶</a></dt>
<dd><p>Save grain boundaries to a GeoJSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> (<em>str</em>) – Filename for csv to be created.</p></li>
<li><p><strong>grains</strong> (<em>list</em>) – List of grains to write to disk.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.get_summary">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">get_summary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grains</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_per_m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#segmenteverygrain.get_summary" title="Link to this definition">¶</a></dt>
<dd><p>Summarize grain information as a DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grains</strong> (<em>list</em>) – List of grains to measure and summarize.</p></li>
<li><p><strong>px_per_m</strong> (<em>float</em><em>, </em><em>default 1.</em>) – Optional conversion from pixels to meters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>df</strong> – Dataframe of grain measurements.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.save_summary">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">save_summary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grains</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_per_m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.save_summary" title="Link to this definition">¶</a></dt>
<dd><p>Save grain measurements as a csv.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> (<em>str</em>) – Filename for csv to be created.</p></li>
<li><p><strong>grains</strong> (<em>list</em>) – List of grains to summarize.</p></li>
<li><p><strong>px_per_m</strong> (<em>float</em><em>, </em><em>default 1.</em>) – Optional conversion from pixels to meters.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.save_histogram">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">save_histogram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grains</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px_per_m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">summary</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#segmenteverygrain.save_histogram" title="Link to this definition">¶</a></dt>
<dd><p>Save histogram of grain size measurements as an image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> (<em>str</em>) – Filename for image to be created. File type will be interpreted.</p></li>
<li><p><strong>grains</strong> (<em>list</em><em> (</em><em>optional</em><em>, </em><em>must provide summary if not given</em><em>)</em>) – List of grains to represent.</p></li>
<li><p><strong>px_per_m</strong> (<em>float</em><em>, </em><em>default 1.</em>) – Conversion from pixels to meters. Ignored if also passing a
pre-generated summary.</p></li>
<li><p><strong>summary</strong> (<em>pd.DataFrame</em><em> (</em><em>optional</em><em>, </em><em>must provide grains if not given</em><em>)</em>) – Grain summary, if already generated from get_summary().</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.save_mask">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">save_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grains</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.save_mask" title="Link to this definition">¶</a></dt>
<dd><p>Save binary mask of grain shapes to disk, optionally scaled to 0-255.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> (<em>str</em>) – Filename for image to be created. File type will be interpreted.</p></li>
<li><p><strong>grains</strong> (<em>list</em>) – List of grains to represent.</p></li>
<li><p><strong>image</strong> (<em>np.ndarray</em>) – Original image.</p></li>
<li><p><strong>scale</strong> (<em>bool</em>) – Whether to scale from 0-255 for human readability (True)
or 0-1 for model training (False).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="grain-extraction-and-clustering-grain-utils-module">
<h2>Grain Extraction and Clustering (grain_utils module)<a class="headerlink" href="#grain-extraction-and-clustering-grain-utils-module" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">grain_utils</span></code> module provides functions for extracting individual grain images, extracting features, and clustering grains.</p>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.extract_grain_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">extract_grain_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_polygon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">224</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.extract_grain_image" title="Link to this definition">¶</a></dt>
<dd><p>Extract a single grain from an image and create a square, unrotated image.</p>
<p>This function takes a grain polygon, extracts the corresponding region from the image,
applies padding, rotates it to align the major axis vertically, makes it square by
padding with zeros, and resizes it to the target size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grain_polygon</strong> (<em>shapely.Polygon</em>) – The grain polygon from all_grains</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The original image (H, W, 3)</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – The U-Net prediction (H, W, 3)</p></li>
<li><p><strong>target_size</strong> (<em>int</em>) – Output image size (default: 224x224)</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Padding around the grain bounding box in pixels</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>grain_image</strong> (<em>numpy.ndarray</em>) – The extracted grain image (target_size, target_size, 3)</p></li>
<li><p><strong>grain_mask</strong> (<em>numpy.ndarray</em>) – Binary mask of the grain (target_size, target_size)</p></li>
<li><p><strong>grain_pred</strong> (<em>numpy.ndarray or None</em>) – The prediction for the grain region (target_size, target_size) if image_pred provided</p></li>
<li><p><strong>original_size</strong> (<em>int</em>) – The size of the square crop before resizing</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grain_img</span><span class="p">,</span> <span class="n">grain_mask</span><span class="p">,</span> <span class="n">grain_pred</span><span class="p">,</span> <span class="n">orig_size</span> <span class="o">=</span> <span class="n">extract_grain_image</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">all_grains</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="p">,</span> <span class="n">image_pred</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.extract_all_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">extract_all_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">224</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.extract_all_grains" title="Link to this definition">¶</a></dt>
<dd><p>Extract all grains from an image.</p>
<p>This function processes all grains in a list and extracts standardized,
square images for each grain suitable for classification or analysis tasks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of shapely.Polygon objects representing grains</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The original image (H, W, 3)</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – The U-Net prediction (H, W, 3)</p></li>
<li><p><strong>target_size</strong> (<em>int</em>) – Output image size (default: 224x224)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>grain_images</strong> (<em>list</em>) – List of grain images, each of shape (target_size, target_size, 3)</p></li>
<li><p><strong>grain_masks</strong> (<em>list</em>) – List of grain masks, each of shape (target_size, target_size, 1)</p></li>
<li><p><strong>grain_preds</strong> (<em>list</em>) – List of grain predictions (or None if image_pred not provided)</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grain_images</span><span class="p">,</span> <span class="n">grain_masks</span><span class="p">,</span> <span class="n">grain_preds</span> <span class="o">=</span> <span class="n">extract_all_grains</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">all_grains</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">image_pred</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="mi">224</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">grain_images</span><span class="p">)</span><span class="si">}</span><span class="s2"> grains&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.make_square">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">make_square</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.make_square" title="Link to this definition">¶</a></dt>
<dd><p>Pad an image to make it square.</p>
<p>This function pads an image with zeros to make its height and width equal.
The padding is distributed evenly on both sides.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>numpy.ndarray</em>) – Image to pad (H, W) or (H, W, C)</p></li>
<li><p><strong>reference_mask</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – If provided, uses this mask’s shape for determining padding</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>im_square</strong> – Square image with zero padding</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">square_image</span> <span class="o">=</span> <span class="n">make_square</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">square_image</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(150, 150, 3)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.extract_vgg16_features">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">extract_vgg16_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'VGG16'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'fc2'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_preprocessing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">32</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.extract_vgg16_features" title="Link to this definition">¶</a></dt>
<dd><p>Extract deep learning features from grain images using a pre-trained CNN.</p>
<p>Images are automatically resized to 224x224 if they are not already that size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grain_images</strong> (<em>list</em><em> or </em><em>numpy.ndarray</em>) – List of grain images, each of shape (H, W, 3). Images will be
automatically resized to 224x224 if necessary.</p></li>
<li><p><strong>model_name</strong> (<em>str</em>) – Name of the pre-trained model to use (‘VGG16’, ‘ResNet50’, etc.)</p></li>
<li><p><strong>layer_name</strong> (<em>str</em>) – Layer to extract features from. Options:
- ‘fc2’ or -2: Second-to-last layer (default, 4096 features for VGG16)
- ‘fc1’ or -3: Third-to-last layer
- ‘flatten’: Flattened convolutional features</p></li>
<li><p><strong>include_preprocessing</strong> (<em>bool</em>) – Whether to apply model-specific preprocessing (recommended)</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – Batch size for prediction (default: 32)</p></li>
<li><p><strong>verbose</strong> (<em>int</em>) – Verbosity level for model.predict (default: 0)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>features</strong> (<em>numpy.ndarray</em>) – Extracted features of shape (n_grains, n_features)</p></li>
<li><p><strong>model</strong> (<em>keras.Model</em>) – The feature extraction model (useful for processing more grains later)</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">features</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">extract_vgg16_features</span><span class="p">(</span><span class="n">grain_images</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(336, 4096)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Works with any size images - they will be auto-resized</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">features_640</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">extract_vgg16_features</span><span class="p">(</span><span class="n">grain_images_640x640</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">features_640</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(336, 4096)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.extract_color_features">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">extract_color_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color_space</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rgb'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.extract_color_features" title="Link to this definition">¶</a></dt>
<dd><p>Extract color-based features from grain images for clustering.</p>
<p>This function computes color statistics from grain images, optionally masking
out the background. Features include mean, standard deviation, and histogram
statistics for each color channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grain_images</strong> (<em>list</em><em> or </em><em>numpy.ndarray</em>) – List of grain images, each of shape (H, W, 3)</p></li>
<li><p><strong>color_space</strong> (<em>str</em>) – Color space to use for feature extraction:
- ‘rgb’: RGB color space (default)
- ‘hsv’: HSV color space (better for color-based clustering)
- ‘lab’: LAB color space (perceptually uniform)
- ‘all’: Concatenate features from all color spaces</p></li>
<li><p><strong>mask_background</strong> (<em>bool</em>) – If True, excludes very dark pixels (assumed to be background) from
color statistics (default: True)</p></li>
<li><p><strong>background_threshold</strong> (<em>int</em>) – Pixels with all channels below this value are considered background
(default: 10, only used if mask_background=True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>features</strong> – Color feature matrix of shape (n_grains, n_features)
Features per channel: mean, std, median, min, max, 25th percentile, 75th percentile
- RGB: 21 features (7 per channel × 3 channels)
- HSV: 21 features (7 per channel × 3 channels)
- LAB: 21 features (7 per channel × 3 channels)
- all: 63 features (concatenation of RGB, HSV, LAB)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Extract RGB color features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">color_features</span> <span class="o">=</span> <span class="n">extract_color_features</span><span class="p">(</span><span class="n">grain_images</span><span class="p">,</span> <span class="n">color_space</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">color_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(336, 21)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use HSV for better color discrimination</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hsv_features</span> <span class="o">=</span> <span class="n">extract_color_features</span><span class="p">(</span><span class="n">grain_images</span><span class="p">,</span> <span class="n">color_space</span><span class="o">=</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cluster_grains</span><span class="p">(</span><span class="n">hsv_features</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use all color spaces for comprehensive features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_features</span> <span class="o">=</span> <span class="n">extract_color_features</span><span class="p">(</span><span class="n">grain_images</span><span class="p">,</span> <span class="n">color_space</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">all_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(336, 63)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.cluster_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">cluster_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'kmeans'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.cluster_grains" title="Link to this definition">¶</a></dt>
<dd><p>Cluster grain features using dimensionality reduction and clustering.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>features</strong> (<em>numpy.ndarray</em>) – Feature matrix of shape (n_grains, n_features)</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em>) – Number of clusters to create</p></li>
<li><p><strong>method</strong> (<em>str</em>) – Clustering method: ‘kmeans’, ‘dbscan’, ‘hierarchical’</p></li>
<li><p><strong>n_components</strong> (<em>int</em><em> or </em><em>None</em>) – Number of PCA components. If None, no dimensionality reduction is applied</p></li>
<li><p><strong>random_state</strong> (<em>int</em>) – Random seed for reproducibility</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – Additional arguments passed to the clustering algorithm</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – Cluster labels for each grain</p></li>
<li><p><strong>reduced_features</strong> (<em>numpy.ndarray</em>) – Dimensionality-reduced features (or original if n_components is None)</p></li>
<li><p><strong>pca</strong> (<em>sklearn.decomposition.PCA or None</em>) – Fitted PCA object (None if n_components is None)</p></li>
<li><p><strong>clusterer</strong> (<em>sklearn clustering object</em>) – Fitted clustering model</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span><span class="p">,</span> <span class="n">reduced_feats</span><span class="p">,</span> <span class="n">pca</span><span class="p">,</span> <span class="n">kmeans</span> <span class="o">=</span> <span class="n">cluster_grains</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">features</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">25</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span><span class="si">}</span><span class="s2"> clusters&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_grain_panel">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_grain_panel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_rows</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cols</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_grain_panel" title="Link to this definition">¶</a></dt>
<dd><p>Create a visual panel of grain images from specified indices.</p>
<p>This function creates a rectangular grid panel containing grain images
from the provided indices. Each grain image is assumed to be 224x224 pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inds</strong> (<em>array-like</em>) – Indices of grains to include in the panel</p></li>
<li><p><strong>all_images</strong> (<em>numpy.ndarray</em>) – Array of all grain images, shape (n_grains, 224, 224, 3)</p></li>
<li><p><strong>n_rows</strong> (<em>int</em>) – Number of rows in the panel grid</p></li>
<li><p><strong>n_cols</strong> (<em>int</em>) – Number of columns in the panel grid</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cl_panel</strong> – Combined panel image with shape (224*n_rows, 224*n_cols, 3)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The number of indices should equal n_rows * n_cols.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">selected_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">panel</span> <span class="o">=</span> <span class="n">create_grain_panel</span><span class="p">(</span><span class="n">selected_indices</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_grain_panel_cluster">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_grain_panel_cluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_images</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_grain_panel_cluster" title="Link to this definition">¶</a></dt>
<dd><p>Create a visual panel of grain images from a specific cluster.</p>
<p>This function creates a square grid panel containing randomly selected grain images
from a specified cluster. Each grain image is assumed to be 224x224 pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cluster_number</strong> (<em>int</em>) – The cluster number to create a panel for</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – Array of cluster labels for each grain</p></li>
<li><p><strong>all_images</strong> (<em>numpy.ndarray</em>) – Array of all grain images, shape (n_grains, 224, 224, 3)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>cl_panel</strong> (<em>numpy.ndarray</em>) – Combined panel image with shape (224*n_rows, 224*n_cols, 3)</p></li>
<li><p><strong>grain_inds</strong> (<em>numpy.ndarray</em>) – 2D array containing the indices of grains used in the panel,
shape (n_rows, n_cols)</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">panel</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">create_grain_panel_cluster</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_clustered_grain_montage">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_clustered_grain_montage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_cols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">224</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">draw_boundaries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary_thickness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_by_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_clustered_grain_montage" title="Link to this definition">¶</a></dt>
<dd><p>Create a single montage image with all grains arranged by cluster.</p>
<p>Grains are arranged in a compact grid, ordered by cluster (cluster 0, then 1, etc.).
Within each cluster, grains can optionally be sorted by size. Grains flow continuously
across rows to minimize white space. Cluster boundaries can be visualized with colored
borders around each grain.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cluster_labels</strong> (<em>numpy.ndarray</em>) – Array of cluster labels for each grain</p></li>
<li><p><strong>grain_images</strong> (<em>list</em><em> or </em><em>numpy.ndarray</em>) – Array of all grain images, shape (n_grains, H, W, 3)</p></li>
<li><p><strong>grid_cols</strong> (<em>int</em>) – Number of grain columns in the grid (default: 20)</p></li>
<li><p><strong>grain_size</strong> (<em>int</em>) – Size of each grain image in pixels (default: 224)</p></li>
<li><p><strong>padding</strong> (<em>int</em>) – Padding between grains in pixels (default: 2)</p></li>
<li><p><strong>draw_boundaries</strong> (<em>bool</em>) – If True, draws colored borders around each grain to indicate cluster (default: True)</p></li>
<li><p><strong>boundary_thickness</strong> (<em>int</em>) – Thickness of cluster boundary in pixels (default: 2)</p></li>
<li><p><strong>all_grains</strong> (<em>list</em><em> of </em><em>shapely.Polygon</em><em>, </em><em>optional</em>) – List of grain polygons. Required if sort_by_size=True</p></li>
<li><p><strong>sort_by_size</strong> (<em>bool</em>) – If True, sorts grains within each cluster by size (area) in descending order.
Requires all_grains to be provided (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>montage</strong> (<em>numpy.ndarray</em>) – Single large image containing all grains arranged by cluster</p></li>
<li><p><strong>cluster_info</strong> (<em>dict</em>) – Dictionary with information about each cluster:
- ‘n_grains’: number of grains in cluster
- ‘grain_indices’: indices of grains in this cluster
- ‘positions’: list of (row, col) positions in the grid</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># With colored borders</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">montage</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">create_clustered_grain_montage</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">,</span> <span class="n">grid_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">montage</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Without borders (pure grid)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">montage</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">create_clustered_grain_montage</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">labels</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">,</span> <span class="n">grid_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">draw_boundaries</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Sorted by size within each cluster</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">montage</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">create_clustered_grain_montage</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">labels</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">,</span> <span class="n">all_grains</span><span class="o">=</span><span class="n">all_grains</span><span class="p">,</span> <span class="n">sort_by_size</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Print cluster info</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;n_grains&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> grains&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_classified_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_classified_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">classifications</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_colors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'black'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">legend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_classified_grains" title="Link to this definition">¶</a></dt>
<dd><p>Plot image with grain masks colored by their classification.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image to be plotted</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – List of shapely Polygon objects representing grain masks</p></li>
<li><p><strong>classifications</strong> (<em>list</em><em> or </em><em>numpy.ndarray</em>) – Classification label for each grain (same length as all_grains)</p></li>
<li><p><strong>class_colors</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary mapping class names to colors. If None, uses default colors.
Colors can be matplotlib color names or RGB tuples.
Example: {‘quartz’: ‘blue’, ‘feldspar’: ‘red’, ‘other’: ‘green’}</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em><em>, </em><em>optional</em>) – Axes object to plot on. If None, creates new figure</p></li>
<li><p><strong>plot_image</strong> (<em>bool</em>) – Whether to plot the background image (default: True)</p></li>
<li><p><strong>im_alpha</strong> (<em>float</em>) – Alpha value for background image (default: 1.0)</p></li>
<li><p><strong>edge_color</strong> (<em>str</em><em> or </em><em>tuple</em>) – Color for grain edges (default: ‘black’)</p></li>
<li><p><strong>edge_width</strong> (<em>float</em>) – Width of grain edges (default: 0.5)</p></li>
<li><p><strong>fill_alpha</strong> (<em>float</em>) – Alpha value for grain fill colors (default: 0.5)</p></li>
<li><p><strong>legend</strong> (<em>bool</em>) – Whether to add a legend (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>fig, ax</strong> – The figure and axes objects</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>matplotlib Figure and Axes</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># After training classifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">predictions</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_classified_grains</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">image</span><span class="p">,</span> <span class="n">all_grains</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">class_colors</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;quartz&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;feldspar&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">ClusterMontageSelector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_cols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">figsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(20,</span> <span class="pre">15)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">224</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary_thickness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_by_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector" title="Link to this definition">¶</a></dt>
<dd><p>Interactive selector for clustered grain montage.</p>
<p>Allows interactive selection and removal of entire clusters or individual grains
for quality control. Click on a cluster to select/deselect all grains in it,
or Shift+Click to select/deselect individual grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cluster_labels</strong> (<em>numpy.ndarray</em>) – Array of cluster labels for each grain</p></li>
<li><p><strong>grain_images</strong> (<em>list</em><em> or </em><em>numpy.ndarray</em>) – Array of all grain images</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – List of grain polygons (shapely.Polygon objects)</p></li>
<li><p><strong>grid_cols</strong> (<em>int</em>) – Number of grain columns in the grid (default: 20)</p></li>
<li><p><strong>figsize</strong> (<em>tuple</em>) – Figure size (default: (20, 15))</p></li>
<li><p><strong>grain_size</strong> (<em>int</em>) – Size of each grain image in pixels (default: 224)</p></li>
<li><p><strong>padding</strong> (<em>int</em>) – Padding between grains in pixels (default: 2)</p></li>
<li><p><strong>boundary_thickness</strong> (<em>int</em>) – Thickness of cluster boundary in pixels (default: 2)</p></li>
<li><p><strong>sort_by_size</strong> (<em>bool</em>) – If True, sorts grains within each cluster by size (area) in descending order
(default: False)</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.selected_grain_indices">
<span class="sig-name descname"><span class="pre">selected_grain_indices</span></span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.selected_grain_indices" title="Link to this definition">¶</a></dt>
<dd><p>Set of grain indices that are selected for removal</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>set</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.selected_clusters">
<span class="sig-name descname"><span class="pre">selected_clusters</span></span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.selected_clusters" title="Link to this definition">¶</a></dt>
<dd><p>Set of cluster IDs that are fully selected</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>set</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.activate">
<span class="sig-name descname"><span class="pre">activate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.activate" title="Link to this definition">¶</a></dt>
<dd><p>Activate interactive selection mode</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.deactivate">
<span class="sig-name descname"><span class="pre">deactivate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.deactivate" title="Link to this definition">¶</a></dt>
<dd><p>Deactivate interactive mode</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.get_filtered_grains">
<span class="sig-name descname"><span class="pre">get_filtered_grains</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.get_filtered_grains" title="Link to this definition">¶</a></dt>
<dd><p>Get the list of grains after removing selected ones</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.get_filtered_labels">
<span class="sig-name descname"><span class="pre">get_filtered_labels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.get_filtered_labels" title="Link to this definition">¶</a></dt>
<dd><p>Get the cluster labels after removing selected grains</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.get_filtered_images">
<span class="sig-name descname"><span class="pre">get_filtered_images</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.get_filtered_images" title="Link to this definition">¶</a></dt>
<dd><p>Get the grain images after removing selected grains</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.get_filtered_indices">
<span class="sig-name descname"><span class="pre">get_filtered_indices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.get_filtered_indices" title="Link to this definition">¶</a></dt>
<dd><p>Get the indices of grains that remain after filtering</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">Interactive</span> <span class="pre">Controls</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">--------------------</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">Left-click:</span> <span class="pre">Select/deselect</span> <span class="pre">entire</span> <span class="pre">cluster</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">Shift</span> <span class="pre">+</span> <span class="pre">Left-click:</span> <span class="pre">Select/deselect</span> <span class="pre">individual</span> <span class="pre">grain</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">'d'</span> <span class="pre">key:</span> <span class="pre">Delete</span> <span class="pre">selected</span> <span class="pre">grains/clusters</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">'r'</span> <span class="pre">key:</span> <span class="pre">Reset</span> <span class="pre">(clear</span> <span class="pre">all</span> <span class="pre">selections)</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">'Esc'</span> <span class="pre">key:</span> <span class="pre">Clear</span> <span class="pre">all</span> <span class="pre">selections</span></span></dt>
<dd></dd></dl>

<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">selector</span> <span class="o">=</span> <span class="n">ClusterMontageSelector</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">,</span> <span class="n">all_grains</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... interact with the plot ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_grains</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">get_filtered_grains</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kept </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_grains</span><span class="p">)</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_grains</span><span class="p">)</span><span class="si">}</span><span class="s2"> grains&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">activate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="Link to this definition">¶</a></dt>
<dd><p>Activate interactive selection mode.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id1">
<span class="sig-name descname"><span class="pre">deactivate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id1" title="Link to this definition">¶</a></dt>
<dd><p>Deactivate interactive mode.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.display_montage">
<span class="sig-name descname"><span class="pre">display_montage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.display_montage" title="Link to this definition">¶</a></dt>
<dd><p>Display the current montage with selection overlays.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">get_filtered_grains</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id2" title="Link to this definition">¶</a></dt>
<dd><p>Get the list of grains after removing selected ones.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filtered_grains</strong> – List of grain polygons with removed grains excluded</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id3">
<span class="sig-name descname"><span class="pre">get_filtered_images</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id3" title="Link to this definition">¶</a></dt>
<dd><p>Get grain images after removing selected grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filtered_images</strong> – List of grain images with removed grains excluded</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id4">
<span class="sig-name descname"><span class="pre">get_filtered_indices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id4" title="Link to this definition">¶</a></dt>
<dd><p>Get the indices of grains that remain after filtering (not removed).</p>
<p>This is useful for filtering other arrays (like all_grains) that are
indexed the same way as the original grain_images/cluster_labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filtered_indices</strong> – Array of indices for grains that were not removed</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">selector</span> <span class="o">=</span> <span class="n">ClusterMontageSelector</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">grain_images</span><span class="p">,</span> <span class="n">all_grains</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">selector</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... interact with the plot to remove some grains ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_idx</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">get_filtered_indices</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered_all_grains</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_grains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filtered_idx</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id5">
<span class="sig-name descname"><span class="pre">get_filtered_labels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id5" title="Link to this definition">¶</a></dt>
<dd><p>Get cluster labels after removing selected grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filtered_labels</strong> – Cluster labels for remaining grains</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.onclick">
<span class="sig-name descname"><span class="pre">onclick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.onclick" title="Link to this definition">¶</a></dt>
<dd><p>Handle mouse click events.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageSelector.onkey">
<span class="sig-name descname"><span class="pre">onkey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageSelector.onkey" title="Link to this definition">¶</a></dt>
<dd><p>Handle keyboard events.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">ClusterMontageLabeler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_colors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_cols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">figsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(20,</span> <span class="pre">15)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">224</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary_thickness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_by_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler" title="Link to this definition">¶</a></dt>
<dd><p>Interactive labeler for clustered grain montage (based on GrainPlot design).</p>
<p>Allows fast interactive labeling of grains or entire clusters with custom labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cluster_labels</strong> (<em>numpy.ndarray</em>) – Array of cluster labels for each grain</p></li>
<li><p><strong>grain_images</strong> (<em>list</em><em> or </em><em>numpy.ndarray</em>) – Array of all grain images</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – List of grain polygons (shapely.Polygon objects)</p></li>
<li><p><strong>label_names</strong> (<em>list</em><em> of </em><em>str</em>) – List of label names (e.g., [‘quartz’, ‘feldspar’, ‘other’])</p></li>
<li><p><strong>label_colors</strong> (<em>list</em><em> of </em><em>str</em><em> or </em><em>tuple</em><em>, </em><em>optional</em>) – Colors for each label. If None, uses default colors.</p></li>
<li><p><strong>grid_cols</strong> (<em>int</em>) – Number of columns in the grid (default: 20)</p></li>
<li><p><strong>figsize</strong> (<em>tuple</em>) – Figure size (default: (20, 15))</p></li>
<li><p><strong>grain_size</strong> (<em>int</em>) – Size of each grain image in pixels (default: 224)</p></li>
<li><p><strong>padding</strong> (<em>int</em>) – Padding between grains (default: 2)</p></li>
<li><p><strong>boundary_thickness</strong> (<em>int</em>) – Border thickness for labeled grains (default: 2)</p></li>
<li><p><strong>sort_by_size</strong> (<em>bool</em>) – Sort grains by size within clusters (default: False)</p></li>
<li><p><strong>blit</strong> (<em>bool</em>) – Use blitting for fast updates (default: True)</p></li>
<li><p><strong>Controls</strong> (<em>Interactive</em>)</p></li>
<li><p><strong>--------------------</strong></p></li>
<li><p><strong>Left-click</strong> (<em>- Shift +</em>)</p></li>
<li><p><strong>Left-click</strong></p></li>
<li><p><strong>(</strong><strong>1-9</strong><strong>)</strong> (<em>- Number keys</em>)</p></li>
<li><p><strong>'r'</strong> (<em>-</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.activate">
<span class="sig-name descname"><span class="pre">activate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.activate" title="Link to this definition">¶</a></dt>
<dd><p>Activate interactive mode.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.deactivate">
<span class="sig-name descname"><span class="pre">deactivate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.deactivate" title="Link to this definition">¶</a></dt>
<dd><p>Deactivate interactive mode.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.export_labels">
<span class="sig-name descname"><span class="pre">export_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.export_labels" title="Link to this definition">¶</a></dt>
<dd><p>Export labels to CSV.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.get_filtered_indices">
<span class="sig-name descname"><span class="pre">get_filtered_indices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.get_filtered_indices" title="Link to this definition">¶</a></dt>
<dd><p>Get indices of labeled grains.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.get_labeled_data">
<span class="sig-name descname"><span class="pre">get_labeled_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.get_labeled_data" title="Link to this definition">¶</a></dt>
<dd><p>Get labeled grain images and labels.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.get_unlabeled_indices">
<span class="sig-name descname"><span class="pre">get_unlabeled_indices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.get_unlabeled_indices" title="Link to this definition">¶</a></dt>
<dd><p>Get indices of unlabeled grains.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.onclick">
<span class="sig-name descname"><span class="pre">onclick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.onclick" title="Link to this definition">¶</a></dt>
<dd><p>Handle mouse clicks.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.ondraw">
<span class="sig-name descname"><span class="pre">ondraw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.ondraw" title="Link to this definition">¶</a></dt>
<dd><p>Handle draw events (recapture background after zoom/pan).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.onkey">
<span class="sig-name descname"><span class="pre">onkey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.onkey" title="Link to this definition">¶</a></dt>
<dd><p>Handle keyboard events.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.save_labeled_images">
<span class="sig-name descname"><span class="pre">save_labeled_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.save_labeled_images" title="Link to this definition">¶</a></dt>
<dd><p>Save labeled grain images to disk, organized by label.</p>
<p>Creates subdirectories for each label and saves images as:
{output_dir}/{label_name}/grain_{grain_index}.png</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>output_dir</strong> (<em>str</em>) – Base directory where labeled images will be saved</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">labeler</span><span class="o">.</span><span class="n">save_labeled_images</span><span class="p">(</span><span class="s1">&#39;labeled_grains&#39;</span><span class="p">)</span>
<span class="go"># Creates:</span>
<span class="go"># labeled_grains/quartz/grain_0.png</span>
<span class="go"># labeled_grains/quartz/grain_5.png</span>
<span class="go"># labeled_grains/feldspar/grain_1.png</span>
<span class="go"># etc.</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="segmenteverygrain.ClusterMontageLabeler.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.ClusterMontageLabeler.update" title="Link to this definition">¶</a></dt>
<dd><p>Update display (using blitting like GrainPlot).</p>
</dd></dl>

</dd></dl>

</section>
<section id="core-segmentation-functions">
<h2>Core Segmentation Functions<a class="headerlink" href="#core-segmentation-functions" title="Link to this heading">¶</a></h2>
<section id="model-prediction">
<h3>Model Prediction<a class="headerlink" href="#model-prediction" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.predict_image_tile">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">predict_image_tile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im_tile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.predict_image_tile" title="Link to this definition">¶</a></dt>
<dd><p>Predicts one image tile using a Unet model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im_tile</strong> (<em>3D array</em>) – The image tile for which the prediction will be done.</p></li>
<li><p><strong>model</strong> – Tensorflow model used for semantic segmentation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>im_tile_pred</strong> – Predicted tile.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.predict_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">predict_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">I</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.predict_image" title="Link to this definition">¶</a></dt>
<dd><p>Segmantic segmentation of the entire image using a Unet model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>2D</em><em> or </em><em>3D array</em>) – The image that is being segmented. Can have one or more channels.</p></li>
<li><p><strong>model</strong> – Tensorflow model used for semantic segmentation.</p></li>
<li><p><strong>I</strong> (<em>int</em>) – Size of the square-shaped image tiles in pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>image_pred</strong> – Semantic segmentation result for the input image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.predict_large_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">predict_large_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_large_objects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_edge_grains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.predict_large_image" title="Link to this definition">¶</a></dt>
<dd><p>Predicts the location of grains in a large image using a patch-based approach.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – The file path of the input image.</p></li>
<li><p><strong>model</strong> (<em>tensorflow.keras.Model</em>) – The Unet model used for the preliminary grain prediction.</p></li>
<li><p><strong>sam</strong> (<em>SamPredictor</em>) – The SAM model used for grain segmentation.</p></li>
<li><p><strong>min_area</strong> (<em>int</em>) – The minimum area threshold for valid grains.</p></li>
<li><p><strong>patch_size</strong> (<em>int</em><em>, </em><em>optional</em>) – The size of each patch. Defaults to 2000.</p></li>
<li><p><strong>overlap</strong> (<em>int</em><em>, </em><em>optional</em>) – The overlap between patches. Defaults to 300.</p></li>
<li><p><strong>remove_large_objects</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove large objects from the segmentation. Defaults to False.</p></li>
<li><p><strong>remove_edge_grains</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove grains touching the edges. When False, grains are kept
only if they touch the outer edges of the full image, but removed if they
touch internal patch boundaries. When True, all edge-touching grains are
removed. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>All_Grains</strong> (<em>list</em>) – A list of grains represented as polygons.</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em>) – The Unet predictions for the entire image.</p></li>
<li><p><strong>all_coords</strong> (<em>numpy.ndarray</em>) – The coordinates of the SAM prompts.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.label_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">label_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbs_max_dist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.label_grains" title="Link to this definition">¶</a></dt>
<dd><p>Label grains in semantic segmentation result and generate prompts for SAM model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>2D</em><em> or </em><em>3d array</em>) – image that was segmented</p></li>
<li><p><strong>image_pred</strong> (<em>3D array</em>) – semantic segmentation result</p></li>
<li><p><strong>dbs_max_dist</strong> (<em>float</em>) – DBSCAN distance parameter; decreasing it results in more SAM prompts and longer processing times</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>labels_simple</em> – the labels as an image</p></li>
<li><p><em>all_coords</em> – pixel coordinates of the prompts</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.sam_segmentation">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">sam_segmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_edge_grains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_large_objects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_edges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.sam_segmentation" title="Link to this definition">¶</a></dt>
<dd><p>Perform segmentation using the Segment Anything Model (SAM).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sam</strong> (<em>SamPredictor</em>) – The SAM model.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image.</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em>) – The output of the Unet segmentation.</p></li>
<li><p><strong>coords</strong> (<em>numpy.ndarray</em>) – The coordinates of the SAM prompts.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – The labeled image that comes from the ‘label_grains’ function.</p></li>
<li><p><strong>min_area</strong> (<em>int</em>) – The minimum area of the grains, in pixels.</p></li>
<li><p><strong>plot_image</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to plot the segmented image. Default is False.</p></li>
<li><p><strong>remove_edge_grains</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove grains that are touching the edge of the image. Default is False.</p></li>
<li><p><strong>remove_large_objects</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to remove large objects. Default is False. This is useful when the segmentation result is not very good.</p></li>
<li><p><strong>keep_edges</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary specifying which edges to keep grains on: {‘top’: bool, ‘bottom’: bool, ‘left’: bool, ‘right’: bool}.
If None, all edges are treated according to remove_edge_grains. Default is None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of polygons representing the segmented grains.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – The labeled image.</p></li>
<li><p><strong>mask_all</strong> (<em>numpy.ndarray</em>) – The mask of all grains.</p></li>
<li><p><strong>grain_data</strong> (<em>pandas.DataFrame</em>) – DataFrame containing properties of each grain.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure or None</em>) – The figure object if plot_image is True, otherwise None.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes or None</em>) – The axes object if plot_image is True, otherwise None.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.one_point_prompt">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">one_point_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.one_point_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Perform SAM segmentation using a single point prompt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>float</em>) – the x-coordinate of the point</p></li>
<li><p><strong>y</strong> (<em>float</em>) – the y-coordinate of the point</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em><em>)</em>) – the input image</p></li>
<li><p><strong>predictor</strong> – the SAM predictor</p></li>
<li><p><strong>ax</strong> (<em>bool</em><em>, </em><em>default True</em>) – whether to plot the segmentation result on an axis</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>sx</em> – the x-coordinates of the contour points</p></li>
<li><p><em>sy</em> – the y-coordinates of the contour points</p></li>
<li><p><em>mask</em> – the segmented mask</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.two_point_prompt">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">two_point_prompt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.two_point_prompt" title="Link to this definition">¶</a></dt>
<dd><p>Perform a two-point-prompt-based segmentation using the SAM model.
Second point is used as background (label=0).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x1</strong> (<em>float</em>) – x-coordinate of the first point</p></li>
<li><p><strong>y1</strong> (<em>float</em>) – y-coordinate of the first point</p></li>
<li><p><strong>x2</strong> (<em>float</em>) – x-coordinate of the second point</p></li>
<li><p><strong>y2</strong> (<em>float</em>) – y-coordinate of the second point</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes to plot the segmentation result</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – the input image</p></li>
<li><p><strong>predictor</strong> – the SAM predictor</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>sx</strong> (<em>numpy.ndarray</em>) – The x-coordinates of the contour points</p></li>
<li><p><strong>sy</strong> (<em>numpy.ndarray</em>) – The y-coordinates of the contour points</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="polygon-operations">
<h3>Polygon Operations<a class="headerlink" href="#polygon-operations" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.find_overlapping_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">find_overlapping_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_overlap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.find_overlapping_polygons" title="Link to this definition">¶</a></dt>
<dd><p>Finds and returns a list of overlapping polygons from the given list of polygons using spatial indexing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>polygons</strong> (<em>list</em>) – A list of polygons.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>overlapping_polygons</strong> – A list of tuples representing the indices of overlapping polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.find_connected_components">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">find_connected_components</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.find_connected_components" title="Link to this definition">¶</a></dt>
<dd><p>Finds connected components in a graph of overlapping polygons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of polygons representing all grains.</p></li>
<li><p><strong>min_area</strong> (<em>float</em>) – Minimum area threshold for valid grains.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>new_grains</strong> (<em>list</em>) – List of polygons that do not overlap and have an area greater than min_area.</p></li>
<li><p><strong>comps</strong> (<em>list</em>) – List of sets, where each set represents a connected component of overlapping polygons.</p></li>
<li><p><strong>g</strong> (<em>networkx.Graph</em>) – The graph of overlapping polygons.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.merge_overlapping_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">merge_overlapping_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.merge_overlapping_polygons" title="Link to this definition">¶</a></dt>
<dd><p>Merge overlapping polygons in a connected component.</p>
<p>This function takes a list of all polygons, a list of polygons that do not overlap with other polygons,
a list of connected components, a minimum area threshold, and the Unet prediction.
It iterates over each connected component and merges the overlapping polygons within that component.
The most similar polygon is selected as the representative polygon for the merged region.
If the area of the representative polygon is greater than the minimum area threshold, it is added to the new polygons list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of all polygons.</p></li>
<li><p><strong>new_grains</strong> (<em>list</em>) – List of polygons that do not overlap each other.</p></li>
<li><p><strong>comps</strong> (<em>list</em>) – List of connected components.</p></li>
<li><p><strong>min_area</strong> (<em>float</em>) – Minimum area threshold.</p></li>
<li><p><strong>image_pred</strong> (<em>numpy.ndarray</em>) – The Unet prediction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>all_grains</strong> – List of merged polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.collect_polygon_from_mask">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">collect_polygon_from_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_n_large_grains</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_bg_fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.collect_polygon_from_mask" title="Link to this definition">¶</a></dt>
<dd><p>Collect polygon from a mask and append it to a list of grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> (<em>ndarray</em>) – Array of labels for each pixel in the image.</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – Boolean mask indicating the region of interest.</p></li>
<li><p><strong>image_pred</strong> (<em>ndarray</em>) – Predicted image from the Unet model.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – List to append the resulting polygons to.</p></li>
<li><p><strong>sx</strong> (<em>ndarray</em>) – X-coordinates of the polygon vertices.</p></li>
<li><p><strong>sy</strong> (<em>ndarray</em>) – Y-coordinates of the polygon vertices.</p></li>
<li><p><strong>min_area</strong> (<em>int</em><em>, </em><em>optional</em>) – Minimum area for a label to be considered significant (default is 100).</p></li>
<li><p><strong>max_n_large_grains</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of large grains allowed in the mask (default is 10).</p></li>
<li><p><strong>max_bg_fraction</strong> (<em>float</em><em>, </em><em>optional</em>) – Maximum fraction of the mask that can be background (default is 0.7).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated list of polygons representing grains.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.pick_most_similar_polygon">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">pick_most_similar_polygon</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.pick_most_similar_polygon" title="Link to this definition">¶</a></dt>
<dd><p>Picks the ‘most similar’ polygon from a list of polygons based on the average IoU scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>polygons</strong> (<em>list</em>) – A list of polygons.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>most_similar_polygon</strong> – The most similar polygon.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Polygon</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.calculate_iou">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">calculate_iou</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">poly1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poly2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.calculate_iou" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the Intersection over Union (IoU) between two polygons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>poly1</strong> (<em>Polygon</em>) – The first polygon.</p></li>
<li><p><strong>poly2</strong> (<em>Polygon</em>) – The second polygon.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>iou</strong> – The IoU value between the two polygons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.rasterize_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">rasterize_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.rasterize_grains" title="Link to this definition">¶</a></dt>
<dd><p>Rasterizes a list of polygons representing grains into an array of labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of polygons representing grains.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The rasterized array of labels.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_labeled_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_labeled_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_labeled_image" title="Link to this definition">¶</a></dt>
<dd><p>Create a labeled image based on the provided grains and input image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of shapely Polygon objects representing the grains.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – Input image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>rasterized</strong> (<em>numpy.ndarray</em>) – Labeled image where each grain is assigned a unique label.</p></li>
<li><p><strong>mask_all</strong> (<em>numpy.ndarray</em>) – Binary mask indicating the presence of grains and their boundaries.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.read_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">read_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.read_polygons" title="Link to this definition">¶</a></dt>
<dd><p>Reads polygons from a GeoJSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fname</strong> (<em>str</em>) – The file path to the GeoJSON file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of Shapely Polygon objects extracted from the GeoJSON file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.save_polygons">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">save_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.save_polygons" title="Link to this definition">¶</a></dt>
<dd><p>Save a list of polygons to a file in GeoJSON format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>polygons</strong> (<em>list</em>) – A list of Shapely polygon objects to be saved.</p></li>
<li><p><strong>fname</strong> (<em>str</em>) – The filename where the GeoJSON data will be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_image_w_colorful_grains">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_image_w_colorful_grains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'viridis'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">im_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_image_w_colorful_grains" title="Link to this definition">¶</a></dt>
<dd><p>Plot image with randomly colored grain masks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image to be plotted.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of shapely Polygon objects representing the grain masks.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes object on which to plot the image and grain masks.</p></li>
<li><p><strong>cmap</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the colormap to use for coloring the grain masks. Default is ‘viridis’.</p></li>
<li><p><strong>plot_image</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to plot the image. Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_grain_axes_and_centroids">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_grain_axes_and_centroids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linewidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">markersize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_grain_axes_and_centroids" title="Link to this definition">¶</a></dt>
<dd><p>Plot the axes and centroids of each grain on the given axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – List of all grains.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – Array of labeled regions.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axis object to plot on.</p></li>
<li><p><strong>linewidth</strong> (<em>int</em><em>, </em><em>optional</em>) – Width of the lines to plot (default is 1).</p></li>
<li><p><strong>markersize</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the markers to plot (default is 10).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_histogram_of_axis_lengths">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_histogram_of_axis_lengths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">major_axis_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minor_axis_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlimits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_histogram_of_axis_lengths" title="Link to this definition">¶</a></dt>
<dd><p>Plots a histogram of the major and minor axis lengths in phi scale.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>major_axis_length</strong> (<em>array-like</em>) – The lengths of the major axes of the grains in millimeters.</p></li>
<li><p><strong>minor_axis_length</strong> (<em>array-like</em>) – The lengths of the minor axes of the grains in millimeters.</p></li>
<li><p><strong>area</strong> (<em>array-like</em><em>, </em><em>optional</em>) – The areas of the grains in square millimeters. If provided, the axis lengths will be weighted by the area.</p></li>
<li><p><strong>binsize</strong> (<em>float</em><em>, </em><em>optional</em>) – The size of the bins for the histogram. Default is 0.1.</p></li>
<li><p><strong>xlimits</strong> (<em>tuple</em><em>, </em><em>optional</em>) – The limits for the x-axis in millimeters. If not provided, the limits will be determined from the data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The figure object containing the plot.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes._subplots.AxesSubplot</em>) – The axes object containing the plot.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.plot_images_and_labels">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">plot_images_and_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.plot_images_and_labels" title="Link to this definition">¶</a></dt>
<dd><p>Plot the input image and its corresponding label side by side.
The third subplot shows the input image with the label overlayed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>numpy.ndarray</em>) – The input image to be plotted.</p></li>
<li><p><strong>label</strong> (<em>numpy.ndarray</em>) – The label image to be plotted.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="model-training">
<h3>Model Training<a class="headerlink" href="#model-training" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.Unet">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">Unet</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.Unet" title="Link to this definition">¶</a></dt>
<dd><p>Creates a U-Net model for image segmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model</strong> – The U-Net model.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tensorflow.keras.Model</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.weighted_crossentropy">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">weighted_crossentropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.weighted_crossentropy" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the weighted cross-entropy loss between the true labels and predicted labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>tensor</em>) – True labels.</p></li>
<li><p><strong>y_pred</strong> (<em>tensor</em>) – Predicted labels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>loss</strong> – Weighted cross-entropy loss.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.patchify_training_data">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">patchify_training_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_dir</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.patchify_training_data" title="Link to this definition">¶</a></dt>
<dd><p>Extracts patches from training images and labels, and saves them to the specified directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – The directory containing the input images and labels.</p></li>
<li><p><strong>patch_dir</strong> (<em>str</em>) – The directory where the patches will be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the paths to the directories where the image patches and label patches are saved.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The function expects the input directory to contain files with ‘image’ and ‘mask’ in their filenames.</p></li>
<li><p>The patches are extracted with a size of 256x256 pixels and a stride of 128 pixels.</p></li>
<li><p>The function creates subdirectories ‘images’ and ‘labels’ within the specified patch directory to save the patches.</p></li>
<li><p>If the input directory does not exist or contains no matching files, the function will print a warning and return.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_train_val_test_data">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_train_val_test_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_train_val_test_data" title="Link to this definition">¶</a></dt>
<dd><p>Splits image and mask data into training, validation, and test datasets, with optional augmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_dir</strong> (<em>str</em>) – Directory containing the image files.</p></li>
<li><p><strong>mask_dir</strong> (<em>str</em>) – Directory containing the mask files.</p></li>
<li><p><strong>augmentation</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, applies data augmentation to the training dataset (default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>train_dataset</strong> (<em>tf.data.Dataset</em>) – TensorFlow dataset for training.</p></li>
<li><p><strong>val_dataset</strong> (<em>tf.data.Dataset</em>) – TensorFlow dataset for validation.</p></li>
<li><p><strong>test_dataset</strong> (<em>tf.data.Dataset</em>) – TensorFlow dataset for testing.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.create_and_train_model">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">create_and_train_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.create_and_train_model" title="Link to this definition">¶</a></dt>
<dd><p>Create and train a U-Net model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_file</strong> (<em>str</em>) – Path to the file containing the model weights.</p></li>
<li><p><strong>train_dataset</strong> (<em>tf.data.Dataset</em>) – Training dataset.</p></li>
<li><p><strong>val_dataset</strong> (<em>tf.data.Dataset</em>) – Validation dataset.</p></li>
<li><p><strong>test_dataset</strong> (<em>tf.data.Dataset</em>) – Test dataset.</p></li>
<li><p><strong>epochs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of epochs to train the model (default is 100).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>model</strong> – Trained U-Net model.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tf.keras.Model</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function will plot the training and validation loss and accuracy over epochs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.load_and_preprocess">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">load_and_preprocess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">augmentations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.load_and_preprocess" title="Link to this definition">¶</a></dt>
<dd><p>Load and preprocess an image and its corresponding mask.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_path</strong> (<em>str</em>) – The file path of the image.</p></li>
<li><p><strong>mask_path</strong> (<em>str</em>) – The file path of the mask.</p></li>
<li><p><strong>augmentations</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to apply augmentations to the image. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – the preprocessed image.</p></li>
<li><p><strong>mask</strong> (<em>numpy.ndarray</em>) – the preprocessed mask.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="utility-functions">
<h3>Utility Functions<a class="headerlink" href="#utility-functions" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.extract_patch">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">extract_patch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.extract_patch" title="Link to this definition">¶</a></dt>
<dd><p>Extract a patch from the image centered on the given coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>np.ndarray</em>) – The large image from which to extract the patch.</p></li>
<li><p><strong>center</strong> (<em>tuple</em>) – The (x, y) coordinates of the center of the patch.</p></li>
<li><p><strong>patch_size</strong> (<em>int</em>) – The size of the patch (assumed to be square).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The extracted patch.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.convert_to_large_image_coords">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">convert_to_large_image_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_origin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.convert_to_large_image_coords" title="Link to this definition">¶</a></dt>
<dd><p>Convert the coordinates from the patch to the large image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sx</strong> (<em>int</em>) – The x-coordinate in the patch.</p></li>
<li><p><strong>sy</strong> (<em>int</em>) – The y-coordinate in the patch.</p></li>
<li><p><strong>patch_origin</strong> (<em>tuple</em>) – The (x, y) coordinates of the top-left corner of the patch in the large image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The (x, y) coordinates in the large image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.classify_points">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">classify_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.classify_points" title="Link to this definition">¶</a></dt>
<dd><p>Classifies points based on their position relative to a line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>feature1</strong> (<em>list</em>) – List of x-coordinates of the points.</p></li>
<li><p><strong>feature2</strong> (<em>list</em>) – List of y-coordinates of the points.</p></li>
<li><p><strong>x1</strong> (<em>float</em>) – x-coordinate of the first point on the line.</p></li>
<li><p><strong>y1</strong> (<em>float</em>) – y-coordinate of the first point on the line.</p></li>
<li><p><strong>x2</strong> (<em>float</em>) – x-coordinate of the second point on the line.</p></li>
<li><p><strong>y2</strong> (<em>float</em>) – y-coordinate of the second point on the line.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of classifications for each point. Each classification is either 0 (on or one side of the line) or 1 (the other side of the line).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.compute_curvature">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">compute_curvature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.compute_curvature" title="Link to this definition">¶</a></dt>
<dd><p>Compute first derivatives and curvature of a curve.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>1D array</em>) – x-coordinates of the curve</p></li>
<li><p><strong>y</strong> (<em>1D array</em>) – y-coordinates of the curve</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>curvature</strong> – curvature of the curve (in 1/units of x and y)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>1D array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.find_grain_size_classes">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">find_grain_size_classes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_size_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlimits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.find_grain_size_classes" title="Link to this definition">¶</a></dt>
<dd><p>Find grain size classes that overlap with a given range.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grain_size_classes</strong> (<em>dict</em>) – A dictionary where keys are grain size class names and values are tuples
of (lower_bound, upper_bound) representing the size range of each class.</p></li>
<li><p><strong>value1</strong> (<em>float</em>) – One end of the range to check for overlapping grain size classes.</p></li>
<li><p><strong>value2</strong> (<em>float</em>) – The other end of the range to check for overlapping grain size classes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>matching_classes</strong> (<em>list</em>) – A list of grain size class names that overlap with the given range.</p></li>
<li><p><strong>bounds</strong> (<em>list</em>) – A list of unique bounds (both lower and upper) from the matching classes.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.get_area_weighted_distribution">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">get_area_weighted_distribution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grain_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">areas</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.get_area_weighted_distribution" title="Link to this definition">¶</a></dt>
<dd><p>Generate an area-weighted distribution of grain sizes.</p>
<p>Parameters:
grain_sizes (list): A list of grain sizes.
areas (list): A list of corresponding areas for the grain sizes.</p>
<p>Returns:
list: An area-weighted list of grain sizes.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.click_for_scale">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">click_for_scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.click_for_scale" title="Link to this definition">¶</a></dt>
<dd><p>Handles mouse click events to measure the distance between two points on a plot.
Prints the distance between the two points in number of pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse click event object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object representing the plot.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.get_grains_from_patches">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">get_grains_from_patches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.get_grains_from_patches" title="Link to this definition">¶</a></dt>
<dd><p>Extract grains from patches on a plot and create a labeled image based on the updated set of grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object containing the patches.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The input image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of Polygon objects representing the extracted grains.</p></li>
<li><p><strong>labels</strong> (<em>numpy.ndarray</em>) – The labeled image where each grain is assigned a unique label.</p></li>
<li><p><strong>mask_all</strong> (<em>numpy.ndarray</em>) – The binary mask image where grains and their boundaries are marked.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The matplotlib Figure object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="legacy-interactive-functions">
<h3>Legacy Interactive Functions<a class="headerlink" href="#legacy-interactive-functions" title="Link to this heading">¶</a></h3>
<p>These functions are from the original interactive editing interface. The new <code class="docutils literal notranslate"><span class="pre">GrainPlot</span></code> class from the <code class="docutils literal notranslate"><span class="pre">interactions</span></code> module is now the recommended approach.</p>
<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onclick">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onclick</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onclick" title="Link to this definition">¶</a></dt>
<dd><p>Run the SAM segmentation based on the prompt that comes from a mouse click event.
If left mouse button is clicked, the point is used as an object (label=1) and a mask is added.
If right mouse button is clicked, the point is used as background (label=0) and the
current mask is adjusted accordingly (if possible).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse click event object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object.</p></li>
<li><p><strong>coords</strong> (<em>list</em>) – A list to store the coordinates of the clicked points.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The image data.</p></li>
<li><p><strong>predictor</strong> (<em>SamPredictor</em>) – The predictor object for segmentation.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onclick2">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onclick2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onclick2" title="Link to this definition">¶</a></dt>
<dd><p>Event handler function for selecting and highlighting grains in a plot,
based on mouse click events. The selected grains then are either deleted or merged,
using the ‘onpress2’ function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse click event object.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of all the grains (polygons).</p></li>
<li><p><strong>grain_inds</strong> (<em>list</em>) – A list to store the indices of the selected grains.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object representing the plot.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onclick_large_image">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onclick_large_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onclick_large_image" title="Link to this definition">¶</a></dt>
<dd><p>Handles mouse click events on a large image for segmentation purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.MouseEvent</em>) – The mouse event that triggered the function.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes object where the image is displayed.</p></li>
<li><p><strong>coords</strong> (<em>list</em><em> of </em><em>tuple</em>) – List of coordinates where the user has clicked.</p></li>
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The large image on which segmentation is performed.</p></li>
<li><p><strong>predictor</strong> (<em>object</em>) – The predictor object used for segmentation.</p></li>
<li><p><strong>patch_size</strong> (<em>int</em><em>, </em><em>optional</em>) – The size of the patch to extract around the clicked point (default is 1000).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Left mouse button (event.button == 1) is used to add an object.</p></li>
<li><p>Right mouse button (event.button == 3) is used to remove the last added object.</p></li>
<li><p>The function updates the display with the segmented region.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onpress">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onpress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onpress" title="Link to this definition">¶</a></dt>
<dd><p>Handle key press events for deleting or merging polygons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.KeyEvent</em>) – The key press event object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The matplotlib Axes object.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The matplotlib Figure object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="segmenteverygrain.onpress2">
<span class="sig-prename descclassname"><span class="pre">segmenteverygrain.</span></span><span class="sig-name descname"><span class="pre">onpress2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_grains</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grain_inds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#segmenteverygrain.onpress2" title="Link to this definition">¶</a></dt>
<dd><p>Handle key press events when deleting or merging grains.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<em>matplotlib.backend_bases.KeyEvent</em>) – The key press event object.</p></li>
<li><p><strong>all_grains</strong> (<em>list</em>) – A list of all grains (polygons).</p></li>
<li><p><strong>grain_inds</strong> (<em>list</em>) – A list of indices corresponding to the grains.</p></li>
<li><p><strong>fig</strong> (<em>matplotlib.figure.Figure</em>) – The figure object.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – The axes object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">segmenteverygrain</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#grain-extraction-and-clustering">Grain extraction and clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#finetuning-the-u-net-model">Finetuning the U-Net model</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#training-the-u-net-model-from-scratch">Training the U-Net model from scratch</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#interactive-editing-interactions-module">Interactive Editing (interactions module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#grain-extraction-and-clustering-grain-utils-module">Grain Extraction and Clustering (grain_utils module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#core-segmentation-functions">Core Segmentation Functions</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="getting_started.html" title="previous chapter">Getting started</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Zoltan Sylvester.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/api_reference.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>