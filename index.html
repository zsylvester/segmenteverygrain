<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>segmenteverygrain &#8212; segmenteverygrain 0.2.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=37f418d5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Getting started" href="getting_started.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <img alt="grains detected in an image" class="align-left" src="_images/gravel_example_mask.png" />
<section id="segmenteverygrain">
<h1>segmenteverygrain<a class="headerlink" href="#segmenteverygrain" title="Link to this heading">¶</a></h1>
<p><a class="reference external" href="https://github.com/zsylvester/segmenteverygrain">GitHub Repository</a></p>
<p><code class="docutils literal notranslate"><span class="pre">segmenteverygrain</span></code> is a Python package that aims to detect grains (or grain-like objects) in images.
The goal is to develop a machine learning model that does a reasonably good job at detecting most of the grains in a photo, so that it is
useful for determining grain size and grain shape, a common task in geomorphology and sedimentary geology. <code class="docutils literal notranslate"><span class="pre">segmenteverygrain</span></code>
relies on the <a class="reference external" href="https://github.com/facebookresearch/segment-anything">Segment Anything Model (SAM)</a>, developed by Meta,
for getting high-quality outlines of the grains. However, SAM requires prompts for every object detected and, when used in
‘everything’ mode, it tends to be slow and results in many overlapping masks and non-grain (background) objects.
To deal with these issues, ‘segmenteverygrain’ relies on a Unet-style, patch-based convolutional neural network to create a
first-pass segmentation which is then used to generate prompts for the SAM-based segmentation. Some of the grains will be missed
with this approach, but the segmentations that are created tend to be of high quality.</p>
<p><code class="docutils literal notranslate"><span class="pre">segmenteverygrain</span></code> also includes a set of functions that make it possible to clean up the segmentation results: delete and
merge objects by clicking on them, and adding grains that were not segmented automatically. The QC-d masks can be saved and
added to a dataset of grain images. These images then can be used to improve the Unet model.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
</div>
<p>To install <code class="docutils literal notranslate"><span class="pre">segmenteverygrain</span></code> you can use <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>segmenteverygrain
</pre></div>
</div>
<p>Or you can install it from the source code:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/zsylvester/segmenteverygrain.git
<span class="nb">cd</span><span class="w"> </span>segmenteverygrain
pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>The easiest way of creating a Python environment in which ‘segmenteverygrain’ works well is to use the <a class="reference external" href="https://github.com/zsylvester/segmenteverygrain/blob/main/environment.yml">environment.yml</a> file with conda (or mamba).</p>
<p>For Apple Silicon users, the <a class="reference external" href="https://github.com/zsylvester/segmenteverygrain/blob/main/environment_macos.yml">environment_macos.yml</a> file is recommended. This will make it possible to use the GPU for training the U-Net models.</p>
</section>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Link to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#loading-the-models">Loading the models</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#running-the-segmentation">Running the segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#quality-control-of-u-net-prediction">Quality control of U-Net prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#sam-segmentation">SAM segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#interactive-editing-of-results">Interactive editing of results</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#adding-new-grains">Adding new grains</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#grain-size-analysis">Grain size analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#saving-results">Saving results</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#large-image-processing">Large image processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#hardware-requirements">Hardware requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#finetuning-the-u-net-model">Finetuning the U-Net model</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#training-the-u-net-model-from-scratch">Training the U-Net model from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.calculate_iou"><code class="docutils literal notranslate"><span class="pre">calculate_iou()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.classify_points"><code class="docutils literal notranslate"><span class="pre">classify_points()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.click_for_scale"><code class="docutils literal notranslate"><span class="pre">click_for_scale()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.collect_polygon_from_mask"><code class="docutils literal notranslate"><span class="pre">collect_polygon_from_mask()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.compute_curvature"><code class="docutils literal notranslate"><span class="pre">compute_curvature()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.convert_to_large_image_coords"><code class="docutils literal notranslate"><span class="pre">convert_to_large_image_coords()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.create_and_train_model"><code class="docutils literal notranslate"><span class="pre">create_and_train_model()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.create_labeled_image"><code class="docutils literal notranslate"><span class="pre">create_labeled_image()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.create_train_val_test_data"><code class="docutils literal notranslate"><span class="pre">create_train_val_test_data()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.extract_patch"><code class="docutils literal notranslate"><span class="pre">extract_patch()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.find_connected_components"><code class="docutils literal notranslate"><span class="pre">find_connected_components()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.find_grain_size_classes"><code class="docutils literal notranslate"><span class="pre">find_grain_size_classes()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.find_overlapping_polygons"><code class="docutils literal notranslate"><span class="pre">find_overlapping_polygons()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.get_area_weighted_distribution"><code class="docutils literal notranslate"><span class="pre">get_area_weighted_distribution()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.get_grains_from_patches"><code class="docutils literal notranslate"><span class="pre">get_grains_from_patches()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.label_grains"><code class="docutils literal notranslate"><span class="pre">label_grains()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.load_and_preprocess"><code class="docutils literal notranslate"><span class="pre">load_and_preprocess()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.merge_overlapping_polygons"><code class="docutils literal notranslate"><span class="pre">merge_overlapping_polygons()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.onclick"><code class="docutils literal notranslate"><span class="pre">onclick()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.onclick2"><code class="docutils literal notranslate"><span class="pre">onclick2()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.onclick_large_image"><code class="docutils literal notranslate"><span class="pre">onclick_large_image()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.one_point_prompt"><code class="docutils literal notranslate"><span class="pre">one_point_prompt()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.onpress"><code class="docutils literal notranslate"><span class="pre">onpress()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.onpress2"><code class="docutils literal notranslate"><span class="pre">onpress2()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.patchify_training_data"><code class="docutils literal notranslate"><span class="pre">patchify_training_data()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.pick_most_similar_polygon"><code class="docutils literal notranslate"><span class="pre">pick_most_similar_polygon()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.plot_grain_axes_and_centroids"><code class="docutils literal notranslate"><span class="pre">plot_grain_axes_and_centroids()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.plot_histogram_of_axis_lengths"><code class="docutils literal notranslate"><span class="pre">plot_histogram_of_axis_lengths()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.plot_image_w_colorful_grains"><code class="docutils literal notranslate"><span class="pre">plot_image_w_colorful_grains()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.plot_images_and_labels"><code class="docutils literal notranslate"><span class="pre">plot_images_and_labels()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.predict_image"><code class="docutils literal notranslate"><span class="pre">predict_image()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.predict_image_tile"><code class="docutils literal notranslate"><span class="pre">predict_image_tile()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.predict_large_image"><code class="docutils literal notranslate"><span class="pre">predict_large_image()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.rasterize_grains"><code class="docutils literal notranslate"><span class="pre">rasterize_grains()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.read_polygons"><code class="docutils literal notranslate"><span class="pre">read_polygons()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.sam_segmentation"><code class="docutils literal notranslate"><span class="pre">sam_segmentation()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.save_polygons"><code class="docutils literal notranslate"><span class="pre">save_polygons()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.two_point_prompt"><code class="docutils literal notranslate"><span class="pre">two_point_prompt()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.Unet"><code class="docutils literal notranslate"><span class="pre">Unet()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="api_reference.html#segmenteverygrain.weighted_crossentropy"><code class="docutils literal notranslate"><span class="pre">weighted_crossentropy()</span></code></a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">segmenteverygrain</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#finetuning-the-u-net-model">Finetuning the U-Net model</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#training-the-u-net-model-from-scratch">Training the U-Net model from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="getting_started.html" title="next chapter">Getting started</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Zoltan Sylvester.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>